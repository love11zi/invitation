var S={init:function(){S.Drawing.init(".canvas"),document.getElementById("canvas-page").classList.add("body--ready"),-1==location.hash.indexOf("address")?S.UI.simulate("our|love|will|go|on|and|on|../img/heart.png"):S.UI.simulate("2016|03|26|welcome|to|our|wedding|../img/heart.png"),S.Drawing.loop(function(){S.Shape.render()}),setTimeout(function(){document.getElementById("canvas-bottom-txt").className="bottom-txt"},22e3),setTimeout(function(){-1==location.hash.indexOf("address")?document.getElementById("canvas-bottom-p").className="flipInX animated":document.getElementById("canvas-bottom-p-address").className="flipInX animated"},23e3),setTimeout(function(){document.getElementById("canvas-bottom-em").className="lightSpeedIn animated"},24e3)}};S.Drawing=function(){var t,e,n;return requestFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},{init:function(n){t=document.querySelector(n),e=t.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(t){S.Drawing.adjustCanvas()})},loop:function(t){n=n?n:t,this.clearFrame(),n(),requestFrame.call(window,this.loop.bind(this))},adjustCanvas:function(){t.width=window.innerWidth,t.height=window.innerHeight},clearFrame:function(){e.clearRect(0,0,t.width,t.height)},getArea:function(){return{w:t.width,h:t.height}},drawCircle:function(t,n){e.fillStyle=n.render(),e.beginPath(),e.arc(t.x,t.y,t.z,0,2*Math.PI,!0),e.closePath(),e.fill()}}}(),S.UI=function(){function t(t){var e=t.getHours(),n=t.getMinutes(),n=10>n?"0"+n:n;return e+":"+n}function e(t){return t&&t.split(" ")[1]}function n(t){return t=t&&t.split(" ")[0],t&&t[0]===w&&t.substring(1)}function i(t,e,n,i){clearInterval(r),s=i?n:1,t(s),(!n||!i&&n>s||i&&s>0)&&(r=setInterval(function(){s=i?s-1:s+1,t(s),(!i&&n&&s===n||i&&0===s)&&clearInterval(r)},e))}function a(h){var o,h,r;l="object"==typeof h?h:l.concat(h.split("|")),i(function(s){switch(r=l.shift(),o=n(r),h=e(r),o){case"countdown":h=parseInt(h)||10,h=h>0?h:10,i(function(t){0===t?0===l.length?S.Shape.switchShape(S.ShapeBuilder.letter("")):a(l):S.Shape.switchShape(S.ShapeBuilder.letter(t),!0)},1e3,h,!0);break;case"rectangle":h=h&&h.split("x"),h=h&&2===h.length?h:[u,u/2],S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(u,parseInt(h[0])),Math.min(u,parseInt(h[1]))));break;case"circle":h=parseInt(h)||u,h=Math.min(h,u),S.Shape.switchShape(S.ShapeBuilder.circle(h));break;case"time":var d=t(new Date);l.length>0?S.Shape.switchShape(S.ShapeBuilder.letter(d)):i(function(){d=t(new Date),d!==c&&(c=d,S.Shape.switchShape(S.ShapeBuilder.letter(c)))},1e3);break;default:"."==r[0]?S.ShapeBuilder.imageFile(r,S.Shape.switchShape):S.Shape.switchShape(S.ShapeBuilder.letter(r))}},3e3,l.length)}function h(){}function o(){h(),d&&document.body.classList.add("touch")}var r,s,c,d=(document.querySelector(".ui-input"),document.querySelector(".ui"),document.querySelector(".help"),document.querySelector(".commands"),document.querySelector(".overlay"),document.querySelector(".canvas"),!1),u=30,l=[],w="#";return o(),{simulate:function(t){a(t)}}}(),S.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},S.Color=function(t,e,n,i){this.r=t,this.g=e,this.b=n,this.a=i},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(t,e){this.p=new S.Point({x:t,y:e,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),n=e[0],i=e[1],a=e[2],h=this.e*a;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(a>1)this.p.x-=n/a*h,this.p.y-=i/a*h;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=2},distanceTo:function(t,e){var n=this.p.x-t.x,i=this.p.y-t.y,a=Math.sqrt(n*n+i*i);return e?[n,i,a]:a},move:function(t,e){(!e||e&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){function t(){r.width=Math.floor(window.innerWidth/o)*o,r.height=Math.floor(window.innerHeight/o)*o,s.fillStyle="red",s.textBaseline="middle",s.textAlign="center"}function e(){var t=s.getImageData(0,0,r.width,r.height).data;dots=[],x=0,y=0,fx=r.width,fy=r.height,w=0,h=0;for(var e=0;e<t.length;e+=4*o)t[e+3]>0&&(dots.push(new S.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=o,x>=r.width&&(x=0,y+=o,e+=4*o*r.width);return{dots:dots,w:w+fx,h:h+fy}}function n(t){s.font="bold "+t+"px "+d}function i(t){return!isNaN(parseFloat(t))&&isFinite(t)}function a(){t(),window.addEventListener("resize",t)}var o=5,r=document.createElement("canvas"),s=r.getContext("2d"),c=500,d="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";return a(),{imageFile:function(t,n){var i=new Image,a=S.Drawing.getArea();i.onload=function(){s.clearRect(0,0,r.width,r.height),s.drawImage(this,0,0,.4*a.w,1.375*a.w),n(e())},i.onerror=function(){n(S.ShapeBuilder.letter("What?"))},i.src=t},circle:function(t){var n=Math.max(0,t)/2;return s.clearRect(0,0,r.width,r.height),s.beginPath(),s.arc(n*o,n*o,n*o,0,2*Math.PI,!1),s.fill(),s.closePath(),e()},letter:function(t){var a=0;return n(c),a=Math.min(c,r.width/s.measureText(t).width*.8*c,r.height/c*(i(t)?1:.45)*c),n(a),s.clearRect(0,0,r.width,r.height),s.fillText(t,r.width/2,r.height/2),e()},rectangle:function(t,e){for(var n=[],i=o*t,a=o*e,h=0;a>h;h+=o)for(var r=0;i>r;r+=o)n.push(new S.Point({x:r,y:h}));return{dots:n,w:i,h:a}}}}(),S.Shape=function(){function t(){var t=S.Drawing.getArea();a=t.w/2-n/2,h=t.h/2-i/2}var e=[],n=0,i=0,a=0,h=0;return{shuffleIdle:function(){for(var t=S.Drawing.getArea(),n=0;n<e.length;n++)e[n].s||e[n].move({x:Math.random()*t.w,y:Math.random()*t.h})},switchShape:function(o,r){var s,c=S.Drawing.getArea();if(n=o.w,i=o.h,t(),o.dots.length>e.length){s=o.dots.length-e.length;for(var d=1;s>=d;d++)e.push(new S.Dot(c.w/2,c.h/2))}for(var d=0,u=0;o.dots.length>0;)u=Math.floor(Math.random()*o.dots.length),e[d].e=r?.25:e[d].s?.14:.11,e[d].s?e[d].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):e[d].move(new S.Point({z:5*Math.random()+5,h:r?18:30})),e[d].s=!0,e[d].move(new S.Point({x:o.dots[u].x+a,y:o.dots[u].y+h,a:1,z:5,h:0})),o.dots=o.dots.slice(0,u).concat(o.dots.slice(u+1)),d++;for(var u=d;u<e.length;u++)e[u].s&&(e[u].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),e[u].s=!1,e[u].e=.04,e[u].move(new S.Point({x:Math.random()*c.w,y:Math.random()*c.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<e.length;t++)e[t].render()}}}();